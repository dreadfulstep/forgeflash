/* HTML5 Flappy ~ JavaScript Code ~ Copyright (C) 2014 flappy.org ~ This contains a (very) stripped version of Modernizr */ (function(e){var t,n=e.document,i=n.createElement("csstester").style,o="Webkit Moz O ms",a=o.split(" "),r=o.toLowerCase().split(" "),s=function(e,n,o){var s,l,d,c=e.charAt(0).toUpperCase()+e.slice(1);if(n){s=(e+" "+r.join(c+" ")+c).split(" ");for(l in s)if(d=n[s[l]],d!==t)return o===!1?s[l]:"function"==typeof d&&"function"==typeof d.bind?d.bind(o||n):d}else{s=(e+" "+a.join(c+" ")+c).split(" ");for(l in s)if(d=s[l],!~(""+d).indexOf("-")&&i[d]!==t)return d}return!1},l="WebkitAnimation"===s("animation")?"webkitAnimationEnd":"animationend",d="WebkitAnimation"===s("animation")?"webkitAnimationIteration":"animationiteration",c=s("transform"),p=s("animationName"),u=s("animationDuration"),m=s("animationTimingFunction"),f=s("requestAnimationFrame",e),h=s("Audio",e),y=s("AudioContext",e),g=s("applicationCache",e),v=n.createElement("div");v.innerHTML="<svg/>";var b="http://www.w3.org/2000/svg"==(v.firstChild&&v.firstChild.namespaceURI);v=null;var E=n.getElementById("gameroot"),w=navigator.userAgent+"",L=!1,C=null,S=null,x=!1;if(/(msie |trident\/)/i.test(w)?(C=w.match(/(?:msie |rv:)(\d+)/i),S=10):/gecko\//i.test(w)&&/rv:/i.test(w)?(C=w.match(/rv:(\d+)/i),S=24):/opr\//i.test(w)?(C=w.match(/opr\/(\d+)/i),S=15):/chrome\//i.test(w)?(C=w.match(/chrome\/(\d+)/i),S=22):/ipod/i.test(w)?(C=w.match(/cpu (?:iphone|ip[oa]d) os (\d+)(?:_(\d+))?/i),S=7,x=!0):/(?:iphone|ipad)/i.test(w)?(C=w.match(/cpu (?:iphone|ip[oa]d) os (\d+)(?:_(\d+))?/i),S=6):/android/i.test(w)?(C=w.match(/android (\d+)(?:\.(\d+))?/i),C&&C[1]&&(parseInt(C[1],10)>4?L=!0:C[2]&&4===parseInt(C[1],10)&&parseInt(C[2],10)>=4&&(L=!0))):/blackberry\//i.test(w)?(C=w.match(/version\/(\d+)/i),S=10):/safari\//i.test(w)?(C=w.match(/version\/(\d+)/i),S=6):L=-1,C&&C[1]&&S&&parseInt(C[1],10)>=S&&(L=!0),x)try{var T=n.querySelector('meta[name="apple-mobile-web-app-capable"]');T&&T.parentNode&&T.parentNode.removeChild(T),T=null}catch(N){}var M=!1,q="Your browser is ",A="unsupported",I="not officially supported",F="outdated",k=": HTML5 Flappy might not work correctly",H="!\n",B="Please upgrade to the latest ",P="Apple iOS",_="Google Chrome or Mozilla Firefox",z=" from the Play Store",D=" for an optimal experience",O=".",R="\n\nIf you are using Opera 15 or newer, try disabling Turbo or Off-Road mode, then reload the page.",W=function(){return/(?:iphone|ip[oa]d)/i.test(w)?P:_+(/android/i.test(w)?z:"")},U=E.querySelector(".root"),j=U.querySelector(".bird"),G=E.querySelector(".flash"),$=U.querySelector(".btn-play"),K=U.querySelector(".btn-share"),X=U.querySelector(".points"),Y=U.querySelector(".scorepanel"),J=Y.querySelector(".score"),Q=Y.querySelector(".best"),V=Y.querySelector(".medal"),Z=U.querySelector(".pipes"),et=E.querySelector(".splash"),tt=E.querySelector(".progress"),nt=tt.querySelector("progress"),it=E.querySelector(".asd > div"),ot=e.getComputedStyle(U),at=e.getComputedStyle(j),rt=null;if(y&&h){var st=new h;st.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")?rt="ogg":(st.canPlayType("audio/x-m4a;")||st.canPlayType("audio/aac;")).replace(/^no$/,"")&&(rt="aac"),st=null}var lt={},dt=null,ct=function(){if(y&&rt)try{dt=new y,["die","hit","point","swooshing","wing"].forEach(function(e){var t=new XMLHttpRequest;t.open("GET","sfx_"+e+"."+rt,!0),t.responseType="arraybuffer",t.onload=function(){dt.decodeAudioData(this.response,function(t){lt[e]=t})},t.send(),t=null})}catch(e){}},pt=!1,ut=function(e,t){if(pt&&dt&&lt[e])try{var n=dt.createBufferSource();n.buffer=lt[e],n.connect(dt.destination),t>0&&(t+=dt.currentTime),n.start?n.start(t):n.noteOn(t)}catch(i){}},mt=0,ft=0,ht=1,yt="",gt=function(){var t=n.body.clientWidth<n.body.clientHeight?n.body.clientWidth/144:n.body.clientHeight/256;if(t!==ht){ht=t,E.style.width=144*ht+"px",E.style.height=256*ht+"px",U.style[c]="scale("+ht+")",tt.style[c]="scale("+ht+")",it.style.width=144*ht+"px";var i=ht*(e.devicePixelRatio||1);x&&i>2&&(i=2);var o=i>3?"zoom4x":i>2?"zoom3x":i>1?"zoom2x":"zoom1x";yt!==o&&(yt=o,n.body.className=o)}},vt=function(e){return e.preventDefault(),e.stopPropagation(),!1},bt=!1,Et=!1,wt="splash",Lt=function(e){E.className=(M?"step_not_supported ":"")+(bt?"night ":"")+(Et?"easy ":"")+("splash"===e?"screen_home ":"")+"screen_"+e,wt=e},Ct=function(){bt=1===Math.floor(2*Math.random())?!0:!1,j.className="bird bird"+Math.floor(3*Math.random())},St=!1,xt=function(){St||(St=!0,ut("hit",0),ut("swooshing",.5),ut("swooshing",1.5),Array.prototype.forEach.call(Z.children,function(t){t.style[c]=e.getComputedStyle(t)[c],t.style[p]="xxxnone"}),Lt("gameover"),G.style.display="block")},Tt=.375,Nt=Tt,Mt=function(e){"birdGoDownMove"===e.animationName&&(j.style[u]=null,j.style.bottom=null,j.style[c]=null,j.className+=" goneDown",xt())},qt=!1,At=0,It=0,Ft=function(e){if(!qt){if(qt=!0,"getready"===wt)return ut("wing",0),j.style[u]=null,Lt("playing"),$t=0,Kt=-1,f(Yt),vt(e);if("playing"===wt){var t=0,n=at[c],i=(n+"").split("(");if("matrix"===i[0]||"matrix3d"===i[0]){var o="matrix3d"===i[0]?13:5,a=i[1].split(")")[0].split(",");t=-parseFloat(a[o]),a[o]="0",n=i[0]+"("+a.join(",")+")"}var r=parseFloat(at.bottom)+t,s=+new Date;if(Et&&At+500>s&&It+6>r&&(r+=6),parseFloat(ot.height)-parseFloat(at.height)>=r){ut("wing",0),At=s,It=r;var l=(2*r-98)/128*Tt/(Et?1:1.28125);Nt=l,j.style[p]="xxxnone",j.style.bottom=r+"px",j.style[c]=n,j.style[u]="0.5s, 1.05s, "+l+"s",j.offsetWidth,j.style[p]=null}return vt(e)}}},kt=function(){qt=!1},Ht=function(e){"opacity1To0"===e.animationName&&(G.style.display="none")},Bt=!1,Pt=!1,_t=function(n){if(n.target===E)if("opacity0To1"===n.animationName)"splash"===wt&&Bt&&(Lt("home"),Bt=!1);else if("opacity1To0"===n.animationName){if("splash"===wt)return et&&et.parentNode&&et.parentNode.removeChild(et),et=null,Bt=!0,t;if(!Pt)return;Pt=!1,mt=0,St=!1,Rt(0),Array.prototype.forEach.call(Z.children,function(e){e.style[c]=null,e.style[p]=null,e.style.bottom="-"+(45+Math.floor(80*Math.random()))+"px"}),Ct(),Lt("getready"),Vt(),e.setTimeout(Vt,0),e.setTimeout(Vt,150)}},zt=0,Dt=!1,Ot=function(){return zt>=mt?(Ut(mt),E.className+=" screen_pointsend",t):(zt++,Wt(J,zt),zt>ft&&(ft=zt,Wt(Q,zt),Dt||(Dt=!0,E.className+=" newhighscore")),e.setTimeout(Ot,100),t)},Rt=function(e){var t=n.createDocumentFragment();do{var i=parseInt(e%10,10);e=parseInt(e/10,10);var o=n.createElement("div");o.className="digit"+i,t.firstChild?t.insertBefore(o,t.firstChild):t.appendChild(o)}while(e>0);for(;X.firstChild;)X.removeChild(X.firstChild);X.appendChild(t)},Wt=function(e,t){var i=n.createDocumentFragment();do{var o=parseInt(t%10,10);t=parseInt(t/10,10);var a=n.createElement("div");a.className="digit"+o,i.firstChild?i.insertBefore(a,i.firstChild):i.appendChild(a)}while(t>0);for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(i)},Ut=function(e){V.className=e>=50?"medal medal3":e>=30?"medal medal2":e>=20?"medal medal1":e>=10?"medal medal0":"medal"},jt=function(t){if("slidePanelIntoPlace"===t.animationName){Wt(J,0),Wt(Q,ft),Ut(0);try{mt>ft&&e.localStorage&&e.localStorage.setItem("flappyBestScore",mt)}catch(n){}zt=0,Dt=!1,e.setTimeout(Ot,200)}},Gt=function(e){"pipeMovement"===e.animationName&&(e.target.style.bottom="-"+(45+Math.floor(80*Math.random()))+"px",e.target.offsetWidth)},$t=0,Kt=-1,Xt=Array.prototype.slice.call(Z.querySelectorAll(".pipe_spacer"),0),Yt=function(){if(!St){f(Yt);var e=j.getBoundingClientRect(),t=Xt[$t].getBoundingClientRect(),n=e.left+e.width/2,i=e.top+e.height/2,o=12*ht/2;n+o>=t.left&&t.right>=n-o?t.top>=i-o||i+o>=t.bottom?(ut("die",0),xt()):Kt!==$t&&n+o>=t.left+20*ht/2&&(ut("point",0),mt++,Rt(mt),Kt=$t):n-o>t.right&&($t=($t+1)%3,Kt=-1)}},Jt=function(){Pt=!0,ut("swooshing",0),Et=e.confirm("OK  		- Easy Mode\nCancel 	- Hard Mode (Original)"),ut("swooshing",0),E.className+=" screen_loading"},Qt=function(){Pt||(ut("swooshing",0),e.open("https://twitter.com/share?url="+encodeURIComponent("http://www.flappy.org/")+"&related=HTML5FlappyBird&hashtags=FlappyBird,HTML5FlappyBird&text="+encodeURIComponent("home"===wt?"Play HTML5 Flappy Bird on your mobile phone, PC or Mac!":"I scored "+mt+" point"+(1===mt?"":"s")+" on HTML5 Flappy Bird!")))},Vt=function(){n.documentElement.scrollTop=(n.documentElement.scrollHeight-n.documentElement.clientHeight)/2},Zt=!1,en=function(){if(!Zt){if(Zt=!0,!(l&&d&&c&&p&&u&&m&&s("backgroundSize")))return E.className="initerror",e.alert(q+A+H+B+W()+O+(/opera\//i.test(w)?R:"")),t;b||L!==!0||(L=!1),f||(L===!0&&(L=!1),f=function(t){e.setTimeout(t,0)});var i=n.createElement("div");i.style[m]="step-end","step-end"!==i.style[m]&&(M=!0),i=null,M&&L===!0&&(L=!1),y&&rt||L!==!0||(L=!1),-1===L?e.alert(q+I+k+H+B+W()+D+O):L||e.alert(q+F+k+H+B+W()+D+O),y&&rt&&(pt=e.confirm("Enable Sound?"));try{e.localStorage&&(ft=parseInt(e.localStorage.getItem("flappyBestScore"),10))}catch(o){}(0>ft||isNaN(ft))&&(ft=0),E.addEventListener("touchstart",Ft,!0),E.addEventListener("mousedown",Ft,!0),E.addEventListener("keydown",Ft,!0),E.addEventListener("touchend",kt,!0),E.addEventListener("mouseup",kt,!0),E.addEventListener("keyup",kt,!0),E.addEventListener("dragstart",vt,!0),E.addEventListener("dragenter",vt,!0),E.addEventListener("dragover",vt,!0),E.addEventListener("drop",vt,!0),E.addEventListener("selectionstart",vt,!0),E.addEventListener("contextmenu",vt,!0),j.addEventListener(l,Mt,!0),G.addEventListener(l,Ht,!0),E.addEventListener(l,_t,!0),Y.addEventListener(l,jt,!0),Z.addEventListener(d,Gt,!0),$.addEventListener("click",Jt,!0),K.addEventListener("click",Qt,!0),ct(),Ct(),Lt("splash"),Vt(),e.setTimeout(Vt,0),e.setTimeout(Vt,150)}};gt(),e.addEventListener("resize",gt,!0),e.addEventListener("load",Vt,!0),e.addEventListener("resize",Vt,!0),Vt(),e.setTimeout(Vt,0),e.setTimeout(Vt,150),g&&navigator.onLine?(g.addEventListener("noupdate",en,!0),g.addEventListener("cached",function(){e.setTimeout(en,500)},!0),g.addEventListener("obsolete",en,!0),g.addEventListener("error",en,!0),g.addEventListener("updateready",function(){Zt||(Zt=!0,e.setTimeout(function(){e.location.reload()},500))},!0),g.addEventListener("downloading",function(){Zt||(nt.setAttribute("value",0),nt.setAttribute("max",100),E.className+=" show_progress",nt.offsetHeight)},!0),g.addEventListener("progress",function(e){Zt||(nt.setAttribute("value",e.loaded),nt.setAttribute("max",e.total),nt.offsetHeight)},!0)):en()})(window);